---
layout: post
title: "Custom year names, plus improvements and bug fixes"
categories: news
author: claudiob 
published: true
date: 2018-06-23
---

Hello, this is Claudio with a quick recap of what changed this week in the [source code of Ruby on Rails](https://github.com/rails/rails).

### [Add `year_format` option to date_select tag](https://github.com/rails/rails/pull/32190)

In Japan, 2000 A.D. is Heisei 12 in Wareki. Other countries like Israel and Thailand also have their own calendars.  
  
_date\_select_ now takes a lambda option _year\_format_ that can be used to customize year names, e.g.: _year\_format: -\>year { "Heisei #{year - 1988}"_.

### [Support more HTTP cache controls](https://github.com/rails/rails/pull/33134)

Add support for the _stale-while-revalidate_ and _stale-if-error_ extensions to the _Cache-Control_ response header. Supporting them will make it easier to utilize reverse proxies and CDNs from Rails without resorting to hacks.  
  

  


### [Reduce Memory Allocation when using `pluck`](https://github.com/rails/rails/pull/33074)

This PR optimises _ActiveRecord::Result#cast\_values_ to avoid creating temporary arrays, reducing the number of objects allocated to 1 per row retrieved.&nbsp;  
Benchmark show that the new version is up to 1.5x faster.  
  


### [Permit configuring the default service URL expiry](https://github.com/rails/rails/commit/b21f50d8ae36d9b50b673579e17bccbe55363b34)

You can now specify the default expiry of URLs generated by Active Storage by setting _config.active\_storage.service\_urls\_expire\_in_. The default is 5 minutes.

### [Fix `touch` to behave consistently](https://github.com/rails/rails/pull/33107)

The _touch_ option recently added to _increment!_&nbsp;in Active Record was not updating update\_at/on attributes when passed attribute names. The behavior has now been fixed.  
  


### [Fix result of transform_values in AC::Parameters](https://github.com/rails/rails/pull/33076)

This method (and _transform\_values!_) was not consistently returning an instance of ActionController::Parameters. This PR (from a first-time contributor!) fixes it.

18 people contributed to Rails this past week, including 2 first-time contributors. Check out the list of [open issues](https://github.com/rails/rails/issues)!  
  
Among other news, a [security vulnerability](https://blog.heroku.com/rails-asset-pipeline-vulnerability) was disclosed this week so update Sprockets to the latest version if you haven't yet.  
  
Oh, and my [talk about Active Storage](https://www.youtube.com/watch?v=-_w4uqoVSpw) at RailsConf 2018 is finally on YouTube. ðŸ¤— Have a great weekend!
